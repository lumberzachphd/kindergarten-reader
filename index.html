<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sight Words!</title>
    
    <link rel="apple-touch-icon" href="https://via.placeholder.com/180/000000/FFFFFF?text=Sight+Words!">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --primary: #5D9CEC;
            --success: #48CFAD;
            --danger: #ED5565;
            --background: #121212;
            --card-bg: #1E1E1E;
            --text-main: #FFFFFF;
            --text-muted: #A0A0A0;
            --border-color: #333;
            
            /* Default Character Colors */
            --char-skin: #FFDFC4;
            --char-hair: #8D5524;
            --char-shirt: #3498db;
            --char-pants: #333;
        }

        * { box-sizing: border-box; }

        body {
            font-family: 'Comic Sans MS', 'Chalkboard SE', sans-serif;
            background-color: var(--background);
            color: var(--text-main);
            margin: 0;
            display: flex;
            flex-direction: column;
            height: 100dvh;
            overflow: hidden;
            touch-action: manipulation;
        }

        .hidden { display: none !important; }

        /* --- START SCREEN --- */
        #start-screen {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: var(--background);
            z-index: 100;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            overflow-y: auto; /* Allow scrolling on small screens */
        }

        .setup-card {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 20px;
            text-align: center;
            width: 100%;
            max-width: 400px;
            border: 1px solid var(--border-color);
        }
        
        h1 { margin: 10px 0; font-size: 1.5rem; }
        p { margin: 10px 0 5px; font-size: 1rem; color: var(--text-muted); }

        input {
            padding: 10px;
            border-radius: 10px;
            border: 1px solid #555;
            background: #333;
            color: white;
            font-size: 1.2rem;
            margin: 5px 0;
            width: 80%;
            text-align: center;
        }

        .color-picker {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 5px 0;
        }

        .color-dot {
            width: 35px; height: 35px;
            border-radius: 50%;
            border: 3px solid #444;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .color-dot:active { transform: scale(0.9); }

        .btn-start {
            background: var(--success);
            color: #121212;
            border: none;
            padding: 12px 40px;
            border-radius: 30px;
            font-size: 1.5rem;
            margin-top: 15px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 4px 0 rgba(0,0,0,0.3);
        }

        /* --- GAME UI --- */
        header {
            width: 100%;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--card-bg);
            border-bottom: 1px solid var(--border-color);
            flex-shrink: 0;
        }

        .mode-toggle {
            padding: 8px 16px;
            font-size: 0.9rem;
            background: var(--primary);
            color: #121212;
            font-weight: bold;
            border: none;
            border-radius: 20px;
            cursor: pointer;
        }

        main {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            padding: 20px;
            position: relative;
            z-index: 10;
        }

        .card {
            background: var(--card-bg);
            width: 100%;
            max-width: 500px;
            min-height: 40%;
            border-radius: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 20px;
            border: 1px solid var(--border-color);
        }

        .word-display {
            font-size: 4rem;
            font-weight: bold;
            margin-bottom: 20px;
            line-height: 1.1;
        }
        
        .word-display.sentence-mode { font-size: 2rem; }

        .controls-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            align-items: center;
            width: 100%;
        }

        .action-row { display: flex; gap: 30px; justify-content: center; }

        button {
            border: none; outline: none; cursor: pointer;
            display: flex; justify-content: center; align-items: center;
            box-shadow: 0 6px 0 rgba(0,0,0,0.4);
            transition: transform 0.1s;
        }
        button:active { transform: scale(0.95) translateY(4px); box-shadow: 0 2px 0 rgba(0,0,0,0.4); }

        .btn-round { width: 80px; height: 80px; border-radius: 50%; font-size: 2.5rem; color: #121212; }
        .btn-speak { background: var(--primary); width: 60px; height: 60px; font-size: 1.8rem; margin-top: 5px; }
        .btn-check { background: var(--success); }
        .btn-wrong { background: var(--danger); }
        
        .btn-restart {
            background: var(--primary);
            color: #121212;
            padding: 15px 30px;
            font-size: 1.5rem;
            border-radius: 30px;
            font-weight: bold;
            display: none; 
        }

        /* --- GAME TRACK --- */
        .track-container {
            width: 100%;
            height: 140px;
            background: linear-gradient(to bottom, #87CEEB 0%, #87CEEB 50%, #4CAF50 50%, #2E7D32 100%);
            position: relative;
            overflow: hidden;
            border-top: 4px solid #333;
            flex-shrink: 0;
        }

        .character-wrapper {
            width: 60px;
            height: 90px; /* Slightly taller for new detailed character */
            position: absolute;
            bottom: 25px;
            left: 10px;
            transition: left 0.5s ease-in-out, transform 0.3s;
            z-index: 5;
        }

        .char-trophy {
            position: absolute;
            font-size: 2.5rem;
            top: -15px;
            right: -20px;
            z-index: 10;
            display: none; 
        }

        /* NEW SVG STYLES */
        .char-svg { width: 100%; height: 100%; overflow: visible; }
        .skin-fill { fill: var(--char-skin); }
        .hair-fill { fill: var(--char-hair); }
        .shirt-fill { fill: var(--char-shirt); }
        .pants-fill { fill: var(--char-pants); }

        .obstacle { position: absolute; bottom: 30px; font-size: 2rem; z-index: 1; }
        .finish-line { position: absolute; right: 10px; bottom: 30px; font-size: 3rem; }

        /* Animations */
        .idle-anim { animation: bounce 2s infinite ease-in-out; }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }

        .jump-anim { animation: jump 0.5s ease-out; }
        @keyframes jump { 0% { transform: translateY(0); } 50% { transform: translateY(-40px) translateX(10px); } 100% { transform: translateY(0); } }

        .shake-animation { animation: shake 0.5s; border: 5px solid var(--danger); }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
        .correct-animation { border: 5px solid var(--success); transform: scale(1.02); }

        .dance-anim { animation: dance 0.6s infinite alternate ease-in-out; }
        @keyframes dance {
            0% { transform: translateY(0) rotate(-10deg); }
            100% { transform: translateY(-20px) rotate(10deg); }
        }

    </style>
</head>
<body>

<div id="start-screen">
    <div class="setup-card">
        <h1>Who is playing?</h1>
        <input type="text" id="player-name" placeholder="Type Name Here" value="Super Reader">
        
        <p>Skin Color</p>
        <div class="color-picker">
            <div class="color-dot" style="background:#fce5cd" onclick="setSkin('#fce5cd')"></div> <div class="color-dot" style="background:#f4c7a6" onclick="setSkin('#f4c7a6')"></div> <div class="color-dot" style="background:#b47d57" onclick="setSkin('#b47d57')"></div> <div class="color-dot" style="background:#5f3e28" onclick="setSkin('#5f3e28')"></div> </div>

        <p>Hair Color</p>
        <div class="color-picker">
            <div class="color-dot" style="background:#f1c40f" onclick="setHair('#f1c40f')"></div> <div class="color-dot" style="background:#e67e22" onclick="setHair('#e67e22')"></div> <div class="color-dot" style="background:#4a3b2a" onclick="setHair('#4a3b2a')"></div> <div class="color-dot" style="background:#000000" onclick="setHair('#000000')"></div> <div class="color-dot" style="background:#e91e63" onclick="setHair('#e91e63')"></div> </div>

        <p>Shirt Color</p>
        <div class="color-picker">
            <div class="color-dot" style="background:#e74c3c" onclick="setShirt('#e74c3c')"></div> <div class="color-dot" style="background:#3498db" onclick="setShirt('#3498db')"></div> <div class="color-dot" style="background:#2ecc71" onclick="setShirt('#2ecc71')"></div> <div class="color-dot" style="background:#9b59b6" onclick="setShirt('#9b59b6')"></div> </div>

        <button class="btn-start" onclick="startGame()">Let's Go!</button>
    </div>
</div>

<header>
    <div style="font-size: 1.2rem; font-weight: bold;">üë§ <span id="display-name">Player</span></div>
    <button class="mode-toggle" onclick="toggleMode()">Mode: Words</button>
</header>

<main>
    <div class="card" id="card">
        <div class="word-display" id="display-text">Loading...</div>
        
        <div class="controls-container" id="game-controls">
            <div class="action-row">
                <button class="btn-round btn-wrong" onclick="markWrong()" aria-label="Incorrect">‚úñ</button>
                <button class="btn-round btn-check" onclick="markCorrect()" aria-label="Correct">‚úì</button>
            </div>
            <button class="btn-round btn-speak" onclick="speakText()" aria-label="Listen">üîä</button>
        </div>

        <button class="btn-restart" id="restart-btn" onclick="resetGame()">Play Again üîÑ</button>
    </div>
</main>

<div class="track-container" id="track">
    <div class="obstacle" style="left: 20%;">üçÑ</div>
    <div class="obstacle" style="left: 45%;">ü™®</div>
    <div class="obstacle" style="left: 70%;">ü™µ</div>
    <div class="finish-line" id="ground-trophy">üèÜ</div>

    <div class="character-wrapper idle-anim" id="character">
        <div class="char-trophy" id="char-trophy">üèÜ</div>
        <svg class="char-svg" viewBox="0 0 100 120">
            <rect x="35" y="80" width="12" height="25" class="pants-fill" rx="4"/>
            <rect x="53" y="80" width="12" height="25" class="pants-fill" rx="4"/>
            <ellipse cx="41" cy="105" rx="8" ry="4" fill="#111"/>
            <ellipse cx="59" cy="105" rx="8" ry="4" fill="#111"/>
            
            <rect x="25" y="50" width="50" height="40" rx="10" class="shirt-fill" />
            
            <rect x="15" y="52" width="15" height="12" rx="5" class="shirt-fill" transform="rotate(20 15 52)"/>
            <rect x="70" y="52" width="15" height="12" rx="5" class="shirt-fill" transform="rotate(-20 85 52)"/>
            
            <circle cx="12" cy="65" r="5" class="skin-fill" />
            <circle cx="88" cy="65" r="5" class="skin-fill" />
            
            <circle cx="50" cy="35" r="22" class="skin-fill" />
            
            <circle cx="43" cy="32" r="2.5" fill="#333" /> <circle cx="57" cy="32" r="2.5" fill="#333" /> <path d="M42,42 Q50,48 58,42" stroke="#333" stroke-width="2" fill="none" stroke-linecap="round"/> <path d="M28,35 Q25,10 50,8 Q75,10 72,35 Q75,20 50,20 Q25,20 28,35" class="hair-fill" />
        </svg>
    </div>
</div>

<script>
    // --- Data ---
    const allWords = [
        "me", "at", "they", "look", "will", "has", "said", "was", "is", "and", 
        "I", "with", "can", "have", "go", "do", "she", "want", "am", "on", 
        "play", "you", "make", "my", "a", "like", "we", "see", "went", "what", 
        "he", "to", "it", "the", "are", "mom", "dad"
    ];

    const wordBank = {
        sub_singular: ["He", "She", "It", "Mom", "Dad"],
        sub_plural: ["We", "They", "You"],
        verb_transitive: ["see", "make", "have", "want", "like"],
        verb_movement: ["play", "look", "go"],
        object_person: ["me", "you", "Mom", "Dad", "it", "us", "them"], 
        modal: ["can", "will"]
    };

    const templates = [
        "[sub_singular] [modal] [verb_movement].",     
        "[sub_plural] [modal] [verb_transitive] it.",  
        "[sub_singular] went to [verb_movement].",     
        "I went to [verb_movement].",                   
        "[sub_plural] [verb_transitive] [object_person].", 
        "I [verb_transitive] [object_person].",            
        "[sub_singular] is with [object_person].",      
        "I am with [object_person].",                   
        "[sub_plural] are on it.",                      
        "Look at [object_person].",                     
        "Do you [verb_transitive] it?",                 
        "What do you [verb_transitive]?",               
        "[sub_singular] said to [verb_movement]."       
    ];

    // --- State ---
    let currentText = "";
    let isSentenceMode = false;
    let strugglePileWords = [];
    let strugglePileSentences = [];
    let celebrationInterval = null; 

    // Scoring
    let correctWordsSet = new Set();
    const WORD_GOAL = allWords.length;

    let sentenceScore = 0;
    const SENTENCE_GOAL = 10; 

    // --- Setup Functions ---
    function setSkin(color) { document.documentElement.style.setProperty('--char-skin', color); }
    function setHair(color) { document.documentElement.style.setProperty('--char-hair', color); }
    function setShirt(color) { document.documentElement.style.setProperty('--char-shirt', color); }

    function startGame() {
        const name = document.getElementById('player-name').value || "Super Reader";
        document.getElementById('display-name').innerText = name;
        document.getElementById('start-screen').style.display = 'none';
        nextItem();
    }

    // --- Core Logic ---
    function toggleMode() {
        isSentenceMode = !isSentenceMode;
        document.querySelector('.mode-toggle').innerText = isSentenceMode ? "Mode: Sentences" : "Mode: Words";
        const display = document.getElementById('display-text');
        
        if (isSentenceMode) {
            display.classList.add('sentence-mode');
        } else {
            display.classList.remove('sentence-mode');
        }
        
        resetGame();
    }

    function getRandom(arr) { return arr[Math.floor(Math.random() * arr.length)]; }

    function generateSentence() {
        let template = getRandom(templates);
        return template.replace(/\[(\w+)\]/g, (match, type) => {
            if (wordBank[type]) return getRandom(wordBank[type]);
            return match; 
        });
    }

    function nextItem() {
        const card = document.getElementById('card');
        card.classList.remove('correct-animation', 'shake-animation');

        let nextText = "";
        let attempts = 0;
        let currentStrugglePile = isSentenceMode ? strugglePileSentences : strugglePileWords;

        do {
            if (currentStrugglePile.length > 0 && Math.random() > 0.5) {
                nextText = getRandom(currentStrugglePile);
            } 
            else if (!isSentenceMode) {
                const unmastered = allWords.filter(w => !correctWordsSet.has(w));
                if (unmastered.length > 0) nextText = getRandom(unmastered);
                else nextText = getRandom(allWords);
            }
            else {
                nextText = generateSentence();
            }
            attempts++;
        } while (nextText === currentText && attempts < 10);

        currentText = nextText;
        document.getElementById('display-text').innerText = currentText;
    }

    function speakText() {
        window.speechSynthesis.cancel();
        const utterance = new SpeechSynthesisUtterance(currentText);
        
        // --- 20% SLOWER RATE ---
        utterance.rate = 0.7; 
        
        window.speechSynthesis.speak(utterance);
    }

    // --- Grading ---
    function markCorrect() {
        let currentStrugglePile = isSentenceMode ? strugglePileSentences : strugglePileWords;
        const pileIndex = currentStrugglePile.indexOf(currentText);
        if (pileIndex > -1) currentStrugglePile.splice(pileIndex, 1);

        if (isSentenceMode) {
            sentenceScore++;
        } else {
            if (!correctWordsSet.has(currentText)) {
                correctWordsSet.add(currentText);
            }
        }
        
        updateCharacterPosition();

        const card = document.getElementById('card');
        card.classList.add('correct-animation');
        
        let hasWon = isSentenceMode ? (sentenceScore >= SENTENCE_GOAL) : (correctWordsSet.size >= WORD_GOAL);
        
        if (!hasWon) {
            setTimeout(() => { nextItem(); }, 800); 
        }
    }

    function markWrong() {
        if (isSentenceMode) {
            strugglePileSentences.push(currentText);
            strugglePileSentences.push(currentText);
        } else {
            strugglePileWords.push(currentText);
            strugglePileWords.push(currentText);
        }
        const card = document.getElementById('card');
        card.classList.add('shake-animation');
        setTimeout(() => { nextItem(); }, 1500);
    }

    // --- Animation & Movement ---
    function updateCharacterPosition() {
        const charEl = document.getElementById('character');
        
        let currentProgress, goal;
        
        if (isSentenceMode) {
            currentProgress = sentenceScore;
            goal = SENTENCE_GOAL;
        } else {
            currentProgress = correctWordsSet.size;
            goal = WORD_GOAL;
        }

        const hasWon = currentProgress >= goal;
        
        let leftPos;
        if (hasWon) {
            leftPos = "calc(100% - 70px)";
        } else {
            const maxPercent = 85; 
            let percent = (currentProgress / goal) * maxPercent;
            leftPos = `calc(${percent}% + 10px)`;
        }

        charEl.classList.remove('idle-anim');
        charEl.classList.add('jump-anim');
        charEl.style.left = leftPos;

        setTimeout(() => {
            charEl.classList.remove('jump-anim');
            
            if (hasWon) {
                triggerWin(); 
            } else {
                charEl.classList.add('idle-anim');
            }
        }, 500);
    }

    function triggerWin() {
        document.getElementById('display-text').innerText = "YOU DID IT!";
        document.getElementById('game-controls').style.display = 'none';
        document.getElementById('restart-btn').style.display = 'block';

        document.getElementById('ground-trophy').style.opacity = '0';
        document.getElementById('char-trophy').style.display = 'block';

        const charEl = document.getElementById('character');
        charEl.classList.add('dance-anim');

        confetti({ particleCount: 200, spread: 100, origin: { y: 0.6 } });
        
        if (celebrationInterval) clearInterval(celebrationInterval);
        celebrationInterval = setInterval(() => {
            confetti({ particleCount: 100, spread: 120, origin: { y: 0.7 } });
        }, 2000);
    }

    function resetGame() {
        if (celebrationInterval) clearInterval(celebrationInterval);
        
        // Reset scores
        correctWordsSet.clear();
        sentenceScore = 0;
        strugglePileWords = [];
        strugglePileSentences = [];
        
        // Reset UI
        document.getElementById('game-controls').style.display = 'flex';
        document.getElementById('restart-btn').style.display = 'none';
        
        const charEl = document.getElementById('character');
        charEl.style.left = '10px';
        charEl.classList.remove('dance-anim');
        charEl.classList.add('idle-anim');
        
        document.getElementById('char-trophy').style.display = 'none';
        document.getElementById('ground-trophy').style.opacity = '1';

        nextItem();
    }
</script>
</body>
</html>
